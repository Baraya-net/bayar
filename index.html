

<!-- BAGIAN TAMPILAN (FRONTEND) -->
<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- PERBAIKAN: Menambahkan Content Security Policy (CSP) via Meta Tag -->
    <!-- Ini adalah upaya untuk melonggarkan kebijakan keamanan. Mungkin tidak berfungsi jika server menerapkan kebijakan yang lebih ketat. -->
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline' https://app-sandbox.duitku.com https://cdnjs.cloudflare.com https://getbootstrap.com; connect-src 'self' https://app-sandbox.duitku.com;">
    <title>Pembayaran Duitku</title>
    <!-- Bootstrap CSS -->
    <link href="https://getbootstrap.com/docs/4.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Duitku.js (Sandbox) -->
    <script src="https://app-sandbox.duitku.com/lib/js/duitku.js"></script>
</head>
<body>
    <div class="col-md-6 col-lg-4 offset-lg-4 offset-md-3 mt-5">
        <div class="bg-light p-5 border shadow">
            <!-- Form Pembayaran -->
            <form>
                <center><h4>Contoh Pembayaran Duitku</h4></center>
                <br>
                <div class="mb-4">
                    <label for="amount">Amount</label>
                    <input required id="amount" min="1" value="10000" type="number" class="form-control" placeholder="10000">
                </div>
                <div class="mb-4">
                    <label for="productDetail">Product Detail</label>
                    <input required id="productDetail" value="Sepatu Trendy" type="text" class="form-control" placeholder="Sepatu Trendy">
                </div>
                <div class="mb-4">
                    <label for="email">Email</label>
                    <input required id="email" value="customer@duitku.com" type="email" class="form-control" placeholder="customer@duitku.com">
                </div>
                <div class="mb-4">
                    <label for="phoneNumber">Phone Number</label>
                    <input required id="phoneNumber" value="08123456789" type="number" class="form-control" placeholder="08123456789">
                </div>
                <div class="mb-4">
                    <label for="paymentUi">Payment Interface</label>
                    <select id="paymentUi" class="form-control">
                        <option value="1">PopUp UI</option>
                        <option value="2">Redirect UI</option>
                    </select>
                </div>
                <button type="button" id="submit" class="btn btn-primary w-100 my-3 shadow" onClick="pay();">Bayar Dengan Duitku</button>
            </form>
        </div>
    </div>

    <!-- JavaScript Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://getbootstrap.com/docs/4.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Script untuk memproses pembayaran -->
    <script type="text/javascript">
        function pay() {
            var buttonPay = document.getElementById("submit");
            buttonPay.disabled = true;
            buttonPay.innerHTML = "Memproses...";

            var amount = document.getElementById("amount").value;
            var productDetail = document.getElementById("productDetail").value;
            var email = document.getElementById("email").value;
            var phoneNumber = document.getElementById("phoneNumber").value;
            var paymentUi = document.getElementById("paymentUi").value;

            $.ajax({
                type: "POST",
                // PERBAIKAN: Mengganti URL ke nama file eksplisit.
                // Ganti 'pembayaran_duitku.php' jika nama file Anda berbeda.
                url: 'pembayaran_duitku.php', 
                data: {
                    paymentAmount: amount,
                    productDetail: productDetail,
                    email: email,
                    phoneNumber: phoneNumber
                },
                dataType: "json",
                cache: false,
                success: function (result) {
                    console.log("Response dari server:", result);

                    if (!result.reference) {
                         alert('Error: ' + (result.Message || 'Gagal membuat transaksi. Periksa console log.'));
                         buttonPay.disabled = false;
                         buttonPay.innerHTML = "Bayar Dengan Duitku";
                         return;
                    }

                    if (paymentUi === "2") { // Redirect UI
                        window.location = result.paymentUrl;
                    } else { // PopUp UI
                        checkout.process(result.reference, {
                            successEvent: function (result) {
                                console.log('success');
                                alert('Pembayaran Berhasil');
                                buttonPay.disabled = false;
                                buttonPay.innerHTML = "Bayar Dengan Duitku";
                            },
                            pendingEvent: function (result) {
                                console.log('pending');
                                alert('Pembayaran Tertunda');
                                buttonPay.disabled = false;
                                buttonPay.innerHTML = "Bayar Dengan Duitku";
                            },
                            errorEvent: function (result) {
                                console.log('error');
                                alert('Pembayaran Gagal');
                                buttonPay.disabled = false;
                                buttonPay.innerHTML = "Bayar Dengan Duitku";
                            },
                            closeEvent: function (result) {
                                console.log('customer closed the popup without finishing the payment');
                                buttonPay.disabled = false;
                                buttonPay.innerHTML = "Bayar Dengan Duitku";
                            }
                        });
                    }
                },
                error: function (xhr, status, error) {
                    console.error("AJAX Error:", xhr.responseText);
                    alert("Terjadi kesalahan server: " + xhr.status + " " + xhr.statusText + ". Silakan coba lagi.");
                    buttonPay.disabled = false;
                    buttonPay.innerHTML = "Bayar Dengan Duitku";
                }
            });
        }
    </script>
</body>
</html>

